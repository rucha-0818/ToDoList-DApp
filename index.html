<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üßæ To-Do List DApp</title>
</head>
<body>
  <h1>üßæ To-Do List DApp</h1>
  <button onclick="connectWallet()">Connect Wallet</button>
  <input id="taskInput" placeholder="Enter new task..." />
  <button onclick="addTask()">Add Task</button>
  <button onclick="loadTasks()">Load Tasks</button>
  <div id="tasks"></div>

  <!-- 1Ô∏è‚É£ Load ethers.js FIRST -->
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>

  <!-- 2Ô∏è‚É£ Then your app logic -->
  <script>
    const contractAddress = "0x0b32F8B0f9375b328d1F6E086Df379480019c267";

    const contractABI = [
      {
        "inputs":[{"internalType":"string","name":"_description","type":"string"}],
        "name":"addTask",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {
        "inputs":[{"internalType":"uint256","name":"_index","type":"uint256"}],
        "name":"toggleComplete",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {
        "inputs":[],
        "name":"getTasks",
        "outputs":[{
          "components":[
            {"internalType":"string","name":"description","type":"string"},
            {"internalType":"bool","name":"completed","type":"bool"}
          ],
          "internalType":"struct ToDoList.Task[]",
          "name":"",
          "type":"tuple[]"
        }],
        "stateMutability":"view",
        "type":"function"
      }
    ];

    let provider, signer, contract;

    async function connectWallet() {
      try {
        if (!window.ethereum) {
          alert("ü¶ä MetaMask not detected!");
          return;
        }

        await window.ethereum.request({ method: "eth_requestAccounts" });

        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();

        const network = await provider.getNetwork();
        if (network.chainId !== 11155111) {
          alert("‚ö†Ô∏è Please switch MetaMask to Sepolia Test Network.");
          return;
        }

        contract = new ethers.Contract(contractAddress, contractABI, signer);
        alert("‚úÖ Wallet connected successfully!");
      } catch (err) {
        console.error("Connection failed:", err);
        alert("‚ö†Ô∏è Connection failed. Check console.");
      }
    }
  </script>
</body>
</html>
