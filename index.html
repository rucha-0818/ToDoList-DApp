<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üßæ To-Do List DApp</title>
</head>
<body style="font-family: sans-serif; text-align: center; margin-top: 40px;">
  <h1>üßæ To-Do List DApp</h1>
  <button id="connectBtn">Connect Wallet</button>

  <br><br>
  <input type="text" id="taskInput" placeholder="Enter new task..." />
  <button id="addTaskBtn">Add Task</button>
  <button id="loadTasksBtn">Load Tasks</button>

  <ul id="taskList"></ul>

  <!-- Load Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

  <script>
    const contractAddress = "0x0b32F8B0f9375b328d1F6E086Df379480019c267"; // ‚úÖ your deployed contract
    const contractABI = [
      {
        "inputs": [{ "internalType": "string", "name": "_description", "type": "string" }],
        "name": "addTask",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{ "internalType": "uint256", "name": "_index", "type": "uint256" }],
        "name": "toggleComplete",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getTasks",
        "outputs": [
          {
            "components": [
              { "internalType": "string", "name": "description", "type": "string" },
              { "internalType": "bool", "name": "completed", "type": "bool" }
            ],
            "internalType": "struct ToDoList.Task[]",
            "name": "",
            "type": "tuple[]"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let provider, signer, contract;

    async function connectWallet() {
      try {
        if (!window.ethereum) {
          alert("ü¶ä Please install MetaMask!");
          return;
        }
        await window.ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        const network = await provider.getNetwork();

        if (network.chainId !== 11155111) {
          alert("‚ö†Ô∏è Please switch MetaMask to Sepolia Test Network.");
          return;
        }

        contract = new ethers.Contract(contractAddress, contractABI, signer);
        alert("‚úÖ Wallet connected successfully!");
      } catch (err) {
        console.error("Connection failed:", err);
        alert("‚ö†Ô∏è Connection failed. Check console.");
      }
    }

    async function addTask() {
      const task = document.getElementById("taskInput").value;
      if (!task) return alert("Please enter a task!");
      try {
        const tx = await contract.addTask(task);
        await tx.wait();
        alert("‚úÖ Task added successfully!");
        document.getElementById("taskInput").value = "";
      } catch (err) {
        console.error(err);
        alert("‚ö†Ô∏è Transaction failed. Check console.");
      }
    }

    async function loadTasks() {
      try {
        const tasks = await contract.getTasks();
        const list = document.getElementById("taskList");
        list.innerHTML = "";
        tasks.forEach((task, index) => {
          const li = document.createElement("li");
          li.textContent = `${task.description} ${task.completed ? "‚úÖ" : "‚ùå"}`;
          list.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        alert("‚ö†Ô∏è Could not load tasks.");
      }
    }

    document.getElementById("connectBtn").onclick = connectWallet;
    document.getElementById("addTaskBtn").onclick = addTask;
    document.getElementById("loadTasksBtn").onclick = loadTasks;
  </script>
</body>
</html>
